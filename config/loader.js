function s(s){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},i=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(s){return Object.getOwnPropertyDescriptor(o,s).enumerable}))),i.forEach(function(t){e(s,t,o[t])})}return s}function e(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}const t=require("postcss-import"),o=require("postcss-cssnext"),i=require("eslint-friendly-formatter"),r=require("mini-css-extract-plugin"),{browserList:a,eslintIgnores:l,eslintRules:n}=require("./bruce"),{IS_DEBUG:h,IS_TS:d,MODERN_BROWSER:p,AbsPath:u,CheckPolyfill:c,DebugLoaders:b,IsExist:m}=require("../util");module.exports=class{constructor(e){const{hash:h,jslint:b,mode:m,output:g,polyfill:f}=e;this.mode=m,this.isJslint=b,this.isOutput=g,this.isPolyfill=f,this.isHash=h,this.isSourceMap=1===this.mode;const y=this.isOutput?p:a,L={exclude:/node_modules/,include:/src/},M=Object.assign({modules:!1,targets:{browsers:y}},c()?{useBuiltIns:"entry"}:this.isPolyfill?{}:{useBuiltIns:"usage"});this.handlebars={helperDirs:u("src/templates/helpers"),partialDirs:u("src/templates/partials")},this.style={sourceMap:this.isSourceMap},this.css={importLoaders:2,sourceMap:this.isSourceMap},this.postcss={plugins:[t(),o({browsers:y})],sourceMap:this.isSourceMap},this.sass={sourceMap:this.isSourceMap},this.less={sourceMap:this.isSourceMap},this.babel={babelrc:!1,cacheDirectory:!0,comments:!0,cwd:u("..",1),plugins:[["@babel/plugin-transform-runtime",{regenerator:!1,useESModules:!0}],["@babel/plugin-proposal-decorators",{legacy:!0}],["@babel/plugin-proposal-class-properties",{loose:!0}],"@babel/plugin-syntax-dynamic-import","lodash"],presets:d?[["@babel/preset-env",M],"@babel/preset-typescript","@babel/preset-react"]:[["@babel/preset-env",M],"@babel/preset-react"],sourceMap:this.isSourceMap},this.eslint={cache:!0,cwd:u("..",1),formatter:i,ignorePattern:l,rules:n},this.imagemin={gifsicle:{optimizationLevel:1},mozjpeg:{quality:70},optipng:{enabled:!1},pngquant:{quality:"70-90",speed:4}},this.rawLoader=s({},L,{test:/\.txt$/,use:[{loader:"raw-loader"}]}),this.hbsLoader=s({},L,{test:/\.(html|hbs)$/,use:[{loader:"handlebars-loader",options:this.handlebars}]}),this.cssLoader={include:/(node_modules|src)/,test:/\.css$/,use:[this.isSourceMap?{loader:"style-loader",options:this.style}:{loader:r.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss}]},this.sassLoader=s({},L,{test:/\.(sass|scss)$/,use:[this.isSourceMap?{loader:"style-loader",options:this.style}:{loader:r.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss},{loader:"sass-loader",options:this.sass}]}),this.lessLoader=s({},L,{test:/\.less$/,use:[this.isSourceMap?{loader:"style-loader",options:this.style}:{loader:r.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss},{loader:"less-loader",options:this.less}]}),this.jsLoader=s({},L,{test:/\.(js|ts|jsx|tsx)$/,use:[{loader:"babel-loader",options:this.babel}]}),this.imgLoader=s({},L,{test:/\.(png|jpe?g|gif|svg)$/,use:[{loader:this.isSourceMap?"file-loader":"url-loader",options:this.isSourceMap?this.file("img"):this.url("img")}]}),this.fontLoader=s({},L,{test:/\.(eot|woff?2|ttf|otf)$/,use:[{loader:"file-loader",options:this.file("font")}]}),this.mediaLoader=s({},L,{test:/\.(wav|mp3|ogg|flac|aac|mp4|webm)(\?.*)?$/,use:[{loader:"file-loader",options:this.file("media")}]})}file(s){return{name:`[name]${this.isHash?".[hash:4]":""}.[ext]`,outputPath:s}}url(s){return{limit:10240,name:`[name]${this.isHash?".[hash:4]":""}.[ext]`,outputPath:s}}getLoader(){m("node_modules/react-hot-loader")&&this.babel.plugins.push(u("node_modules/react-hot-loader/babel")),!this.isJslint&&1===this.mode||d||this.jsLoader.use.push({loader:"eslint-loader",options:this.eslint}),1!==this.mode&&this.imgLoader.use.push({loader:"image-webpack-loader",options:this.imagemin});const s=[this.rawLoader,this.hbsLoader,this.cssLoader,this.sassLoader,this.lessLoader,this.jsLoader,this.imgLoader,this.fontLoader,this.mediaLoader];return h&&b(s),{rules:s}}};