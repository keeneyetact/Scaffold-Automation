function e(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);s&&(o=o.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,o)}return t}function s(s){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?e(r,!0).forEach((function(e){t(s,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):e(r).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(r,e))}))}return s}function t(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}const o=require("postcss-import"),r=require("postcss-preset-env"),a=require("eslint-friendly-formatter"),i=require("mini-css-extract-plugin"),{browserList:l,eslintIgnores:u,eslintRules:d,frame:n,useTs:h}=require("./bruce"),{BROWSER:p}=require("../util/getting"),{AbsPath:c,IsExist:b}=require("../util/setting");module.exports=class{constructor(e){const{MODE:t="dll",HAS_POLYFILL:m=!1,USE_ES6:g=!1,USE_HASH:f=!1,USE_JSLINT:y=!1,USE_POLYFILL:L=!1}=e;this.mode=t,this.useJslint=y,this.useEs6=g,this.usePolyfill=L,this.useHash=f,this.useSourceMap="dev"===this.mode,this.hasPolyfill=m,this.loaderScope={exclude:/node_modules/,include:/src/},this.browsers=this.useEs6?p:l,this.envOpts=Object.assign({modules:!1,targets:{browsers:this.browsers}},this.hasPolyfill?{corejs:3,useBuiltIns:"entry"}:this.usePolyfill?{}:{corejs:3,useBuiltIns:"usage"}),this.handlebars={helperDirs:c("src/templates/helpers"),partialDirs:c("src/templates/partials")},this.style={sourceMap:this.useSourceMap},this.css={importLoaders:2,sourceMap:this.useSourceMap},this.postcss={plugins:[o(),r({browsers:this.browsers})],sourceMap:this.useSourceMap},this.sass={sourceMap:this.useSourceMap},this.less={sourceMap:this.useSourceMap},this.babel={babelrc:!1,cacheDirectory:!0,comments:!0,cwd:c("..",1),plugins:[["@babel/plugin-transform-runtime",{regenerator:!1,useESModules:!0}],["@babel/plugin-proposal-decorators",{legacy:!0}],["@babel/plugin-proposal-class-properties",{loose:!0}],["@babel/plugin-proposal-nullish-coalescing-operator"],["@babel/plugin-proposal-optional-chaining"],["@babel/plugin-syntax-dynamic-import"],"lodash"],presets:[["@babel/preset-env",this.envOpts],h&&"@babel/preset-typescript"].filter(Boolean),sourceMap:this.useSourceMap},this.babelReact=Object.assign({},this.babel,{plugins:[...this.babel.plugins,["import",{libraryDirectory:"es",libraryName:"antd",style:"css"},"antd"],["import",{libraryDirectory:"es",libraryName:"antd-mobile",style:"css"},"antd-mobile"],["import",{libraryDirectory:"es",libraryName:"ant-design-vue",style:"css"},"ant-design-vue"],b("node_modules/react-hot-loader")&&c("node_modules/react-hot-loader/babel")].filter(Boolean),presets:[...this.babel.presets,"@babel/preset-react"]}),this.tsVue={appendTsSuffixTo:[/\.vue$/]},this.eslint={cache:!0,configFile:c(`../temp/configs/eslintrc-${n}.json`,1),cwd:c("..",1),formatter:a,ignorePattern:u,rules:d},this.imagemin={gifsicle:{optimizationLevel:1},mozjpeg:{quality:70},optipng:{enabled:!1},pngquant:{quality:[.7,.9],speed:4}},this.rawLoader=s({},this.loaderScope,{test:/\.txt$/,use:[{loader:"raw-loader"}]}),this.hbsLoader=s({},this.loaderScope,{test:/\.(hbs|html)$/,use:[{loader:"handlebars-loader",options:this.handlebars}]}),this.cssLoader={include:/(node_modules|src)/,test:/\.css$/,use:[this.useSourceMap?{loader:"style-loader"}:{loader:i.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss}]},this.sassLoader=s({},this.loaderScope,{test:/\.(sass|scss)$/,use:[this.useSourceMap?{loader:"style-loader"}:{loader:i.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss},{loader:"sass-loader",options:this.sass}]}),this.lessLoader=s({},this.loaderScope,{test:/\.less$/,use:[this.useSourceMap?{loader:"style-loader"}:{loader:i.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss},{loader:"less-loader",options:this.less}]}),this.babelLoader=s({},this.loaderScope,{test:/\.(js|ts)$/,use:[{loader:"babel-loader",options:this.babel}]}),this.babelReactLoader=s({},this.loaderScope,{test:/\.(js|ts|jsx|tsx)$/,use:[{loader:"babel-loader",options:this.babelReact}]}),this.babelVueLoader={exclude:e=>/node_modules/.test(e)&&!/\.vue\.js/.test(e),test:/\.js$/,use:[{loader:"babel-loader",options:this.babel}]},this.tsVueLoader=s({},this.loaderScope,{test:/\.ts$/,use:[{loader:"ts-loader",options:this.tsVue}]}),this.vueLoader=s({},this.loaderScope,{test:/\.vue$/,use:[{loader:"vue-loader"}]}),this.imgLoader=s({},this.loaderScope,{test:/\.(jpe?g|png|gif|svg)$/,use:[{loader:this.useSourceMap?"file-loader":"url-loader",options:this.useSourceMap?this.file("img"):this.url("img")}]}),this.fontLoader=s({},this.loaderScope,{test:/\.(eot|otf|ttf|woff2?)$/,use:[{loader:"file-loader",options:this.file("font")}]}),this.mediaLoader=s({},this.loaderScope,{test:/\.(wav|wv|ape|flac|alac|mp3|aac|ogg|opus|mp4|rm|rmvb|3gb|wmv|asf|asx|mov|m4v|avi|dat|mkv|flv|vob)$/,use:[{loader:"file-loader",options:this.file("media")}]})}file(e){return{name:`[name]${this.useHash?".[hash:4]":""}.[ext]`,outputPath:e}}url(e){return{limit:10240,name:`[name]${this.useHash?".[hash:4]":""}.[ext]`,outputPath:e}}getLoader(){if(this.useJslint&&!h){const e={loader:"eslint-loader",options:this.eslint};this.babelLoader.use.push(e),this.babelReactLoader.use.push(e),this.babelVueLoader.use.push(e)}"dev"!==this.mode&&this.imgLoader.use.push({loader:"image-webpack-loader",options:this.imagemin});const e={default:[this.babelLoader],react:[this.babelReactLoader],vue:[h?this.tsVueLoader:this.babelVueLoader,this.vueLoader]}[n];return{rules:[this.rawLoader,this.hbsLoader,this.cssLoader,this.sassLoader,this.lessLoader,this.imgLoader,this.fontLoader,this.mediaLoader,...e].filter(Boolean)}}};