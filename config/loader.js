function s(s){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(s){return Object.getOwnPropertyDescriptor(o,s).enumerable}))),r.forEach(function(t){e(s,t,o[t])})}return s}function e(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}const t=require("postcss-import"),o=require("postcss-preset-env"),r=require("eslint-friendly-formatter"),i=require("mini-css-extract-plugin"),{browserList:a,eslintIgnores:l,eslintRules:u,useTs:d}=require("./bruce"),{BROWSER:h}=require("../util/getting"),{AbsPath:n,IsExist:p}=require("../util/setting");module.exports=class{constructor(e){const{MODE:p="dll",HAS_POLYFILL:c=!1,USE_ES6:b=!1,USE_HASH:m=!1,USE_JSLINT:g=!1,USE_POLYFILL:y=!1}=e;this.mode=p,this.useJslint=g,this.useEs6=b,this.usePolyfill=y,this.useHash=m,this.useSourceMap="dev"===this.mode,this.hasPolyfill=c,this.loaderScope={exclude:/node_modules/,include:/src/},this.browsers=this.useEs6?h:a,this.envOpts=Object.assign({modules:!1,targets:{browsers:this.browsers}},this.hasPolyfill?{corejs:3,useBuiltIns:"entry"}:this.usePolyfill?{}:{corejs:3,useBuiltIns:"usage"}),this.handlebars={helperDirs:n("src/templates/helpers"),partialDirs:n("src/templates/partials")},this.style={sourceMap:this.useSourceMap},this.css={importLoaders:2,sourceMap:this.useSourceMap},this.postcss={plugins:[t(),o()],sourceMap:this.useSourceMap},this.sass={sourceMap:this.useSourceMap},this.less={sourceMap:this.useSourceMap},this.babel={babelrc:!1,cacheDirectory:!0,comments:!0,cwd:n("..",1),plugins:[["@babel/plugin-transform-runtime",{regenerator:!1,useESModules:!0}],["@babel/plugin-proposal-decorators",{legacy:!0}],["@babel/plugin-proposal-class-properties",{loose:!0}],["@babel/plugin-syntax-dynamic-import"],["import",{libraryDirectory:"es",libraryName:"antd",style:"css"},"antd"],["import",{libraryDirectory:"es",libraryName:"antd-mobile",style:"css"},"antd-mobile"],["import",{libraryDirectory:"es",libraryName:"ant-design-vue",style:"css"},"ant-design-vue"],"lodash"],presets:[["@babel/preset-env",this.envOpts],d?"@babel/preset-typescript":null,"@babel/preset-react"].filter(Boolean),sourceMap:this.useSourceMap},this.eslint={cache:!0,cwd:n("..",1),formatter:r,ignorePattern:l,rules:u},this.imagemin={gifsicle:{optimizationLevel:1},mozjpeg:{quality:70},optipng:{enabled:!1},pngquant:{quality:"70-90",speed:4}},this.rawLoader=s({},this.loaderScope,{test:/\.txt$/,use:[{loader:"raw-loader"}]}),this.hbsLoader=s({},this.loaderScope,{test:/\.(html|hbs)$/,use:[{loader:"handlebars-loader",options:this.handlebars}]}),this.cssLoader={include:/(node_modules|src)/,test:/\.css$/,use:[this.useSourceMap?{loader:"style-loader",options:this.style}:{loader:i.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss}]},this.sassLoader=s({},this.loaderScope,{test:/\.(sass|scss)$/,use:[this.useSourceMap?{loader:"style-loader",options:this.style}:{loader:i.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss},{loader:"sass-loader",options:this.sass}]}),this.lessLoader=s({},this.loaderScope,{test:/\.less$/,use:[this.useSourceMap?{loader:"style-loader",options:this.style}:{loader:i.loader},{loader:"css-loader",options:this.css},{loader:"postcss-loader",options:this.postcss},{loader:"less-loader",options:this.less}]}),this.jsLoader=s({},this.loaderScope,{test:/\.(js|ts|jsx|tsx)$/,use:[{loader:"babel-loader",options:this.babel}]}),this.imgLoader=s({},this.loaderScope,{test:/\.(png|jpe?g|gif|svg)$/,use:[{loader:this.useSourceMap?"file-loader":"url-loader",options:this.useSourceMap?this.file("img"):this.url("img")}]}),this.fontLoader=s({},this.loaderScope,{test:/\.(eot|woff?2|ttf|otf)$/,use:[{loader:"file-loader",options:this.file("font")}]}),this.mediaLoader=s({},this.loaderScope,{test:/\.(wav|mp3|ogg|flac|aac|mp4|webm)(\?.*)?$/,use:[{loader:"file-loader",options:this.file("media")}]})}file(s){return{name:`[name]${this.useHash?".[hash:4]":""}.[ext]`,outputPath:s}}url(s){return{limit:10240,name:`[name]${this.useHash?".[hash:4]":""}.[ext]`,outputPath:s}}getLoader(){return p("node_modules/react-hot-loader")&&this.babel.plugins.push(n("node_modules/react-hot-loader/babel")),this.useJslint&&!d&&this.jsLoader.use.push({loader:"eslint-loader",options:this.eslint}),"dev"!==this.mode&&this.imgLoader.use.push({loader:"image-webpack-loader",options:this.imagemin}),{rules:[this.rawLoader,this.hbsLoader,this.cssLoader,this.sassLoader,this.lessLoader,this.jsLoader,this.imgLoader,this.fontLoader,this.mediaLoader]}}};