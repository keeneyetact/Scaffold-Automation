const e=require("child_process"),t=require("fs"),s=require("util"),a=require("chalk"),r=require("make-dir"),i=require("ora"),c=require("recursive-copy"),{COMPONENT:o,PACKAGE:n,PAGE:p}=require("./maplist"),{TEMPLATE_TEXT:l,FormatBool:g}=require("../i18n"),{DEPENDENCE:m,IS_TS:d,AbsPath:u,ShowMsg:f,TitleCase:y}=require("../util");async function $(c="",n=!1){const p=c.split("/").pop(),$=d?"ts":"js",{importPT:w,importR:x,interfaces:S,props:h,render:F,statics:P}=o;await r(u(c));const q=u("../template/component/style.txt",1),E=u(`${c}/index.scss`),T=t.readFileSync(q,"utf8").replace(/demo/g,p);t.writeFileSync(E,T,"utf8");const j=u("../template/component/script.txt",1),D=u(`${c}/index.${$}x`),N=t.readFileSync(j,"utf8");if(n&&!m["prop-types"]){const t=i(l.ptInstalling),a=s.promisify(e.exec);t.start(),await a(`npm i prop-types${d?" && npm i -D @types/prop-types":""}`),t.stop(),f("green",l.ptInstalled)}const b=x[$]+(n?w[$]:""),A=n?P[$]:"",C=n?S[$]:"",I=F[$],k=n?h[$]:"",B=N.replace(/demo/g,p).replace(/Demo/g,y(p)).replace(/#import#/g,b).replace(/#static#/g,A).replace(/#interface#/,C).replace(/#render#/g,I).replace(/#props#/g,k);t.writeFileSync(D,B,"utf8"),console.log(l.compName+a.yellowBright(y(p))),console.log(l.compPath+a.yellowBright(c)),console.log(l.compProp+a.yellowBright(g(n))),f("green",l.newSucceed)}async function w(e="demo",s={},a={},r=!1){const i=Object.assign(n,{name:e,dependencies:s,devDependencies:a,useTs:r}),o=u(`${e}/package.json`),p=JSON.stringify(i,null,"\t"),l=u("../template/tsconfig.json",1),g=u(`${e}/tsconfig.json`);t.writeFileSync(o,p,"utf8"),r&&await c(l,g)}async function x(e="demo",s=!1,a=!1){let i=["index","home","about","contact"];const o=a?"ts":"js",{imports:n,logo:g,note:m,render:d}=p;s?i.shift():i=[i.shift()],await c(u("../template/assets",1),u(`${e}/src/assets`));const $=u("../template/page/template.txt",1),w=t.readFileSync($,"utf8"),x=u("../template/page/style.txt",1),S=t.readFileSync(x,"utf8"),h=u("../template/page/script.txt",1),F=t.readFileSync(h,"utf8");for(let a of i){s&&await r(u(`${e}/src/pages/${a}`));const i=u(`${e}/src${s?`/pages/${a}`:""}/index.html`),c=w.replace(/Demo/g,y(a));t.writeFileSync(i,c,"utf8");const p=u(`${e}/src${s?`/pages/${a}`:""}/index.scss`),l=S.replace(/demo/g,a);t.writeFileSync(p,l,"utf8");const f=u(`${e}/src${s?`/pages/${a}`:""}/index.${o}x`);let $=F.replace(/Demo/g,y(a)).replace(/demo-page/g,a+"-page").replace(/demo.jsx/g,`${s?`pages/${a}/`:""}index.${o}x`).replace(/#import#/g,n[o]).replace(/#logo#/g,g[o]).replace(/#render#/g,d[o]).replace(/#note#/g,m[o]);s&&($=$.replace(/.\/assets/g,"@/assets")),t.writeFileSync(f,$,"utf8")}f("green",l.initSucceed)}async function S(t="demo"){await c(u("../template/static",1),u(`${t}/src`)),await c(u("../template/assets",1),u(`${t}/src/assets`));const a=i(l.depInstalling),r=s.promisify(e.exec);a.start(),await w(t),await r(`cd ${t} && npm i @babel/polyfill`),a.stop(),f("green",l.depInstalled)}module.exports={WriteComponent:$,WritePackage:w,WritePage:x,WritePageStatic:S};