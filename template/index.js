const e=require("child_process"),t=require("fs"),s=require("util"),r=require("chalk"),c=require("make-dir"),a=require("ora"),i=require("recursive-copy"),{COMPONENT:n,PACKAGE:o,PAGE:p}=require("./template"),{CONFIG_TEXT:l,TEMPLATE_TEXT:g,FormatBool:m}=require("../i18n"),{DEPENDENCE:d,IS_TS:u,AbsPath:f,IsExist:y,ShowMsg:$,TitleCase:w}=require("../util");async function x(i="",o=!1){const p=i.split("/").pop(),l=u?"ts":"js",{importPT:y,importR:x,interfaces:S,props:E,render:F,statics:h}=n;await c(f(i));const P=f("../template/component/style.txt",1),j=f(`${i}/index.scss`),T=t.readFileSync(P,"utf8").replace(/demo/g,p);t.writeFileSync(j,T,"utf8");const q=f("../template/component/script.txt",1),b=f(`${i}/index.${l}x`),C=t.readFileSync(q,"utf8");if(o&&!d["prop-types"]){const t=a(g.ptInstalling),r=s.promisify(e.exec);t.start(),await r(`npm i prop-types${u?" && npm i -D @types/prop-types":""}`),t.stop(),$("green",g.ptInstalled)}const D=x[l]+(o?y[l]:""),I=o?h[l]:"",N=o?S[l]:"",A=F[l],O=o?E[l]:"",W=C.replace(/demo/g,p).replace(/Demo/g,w(p)).replace(/#import#/g,D).replace(/#static#/g,I).replace(/#interface#/,N).replace(/#render#/g,A).replace(/#props#/g,O);t.writeFileSync(b,W,"utf8"),console.log(g.compName+r.yellowBright(w(p))),console.log(g.compPath+r.yellowBright(i)),console.log(g.compProp+r.yellowBright(m(o))),$("green",g.newSucceed)}async function S(){const e=f("../template/brucerc.js",1),t=f("brucerc.js");y("brucerc.js")?$("red",l.judgeExist):(await i(e,t),$("green",l.configSucceed))}async function E(e="demo",s={},r={},c=!1){const a=Object.assign(o,{name:e,dependencies:s,devDependencies:r,useTs:c}),n=f(`${e}/package.json`),p=JSON.stringify(a,null,"\t"),l=f("../template/tsconfig.json",1),g=f(`${e}/tsconfig.json`);t.writeFileSync(n,p,"utf8"),c&&await i(l,g)}async function F(e="demo",s=!1,r=!1){let a=["index","home","about","contact"];const n=r?"ts":"js",{imports:o,logo:l,note:m,render:d}=p;s?a.shift():a=[a.shift()];const u=f("../template/assets",1),y=f(`${e}/src/assets`);await i(u,y);const x=f("../template/page/template.txt",1),S=t.readFileSync(x,"utf8"),E=f("../template/page/style.txt",1),F=t.readFileSync(E,"utf8"),h=f("../template/page/script.txt",1),P=t.readFileSync(h,"utf8");for(let r of a){s&&await c(f(`${e}/src/pages/${r}`));const a=f(`${e}/src${s?`/pages/${r}`:""}/index.html`),i=S.replace(/Demo/g,w(r));t.writeFileSync(a,i,"utf8");const p=f(`${e}/src${s?`/pages/${r}`:""}/index.scss`),g=F.replace(/demo/g,r);t.writeFileSync(p,g,"utf8");const u=f(`${e}/src${s?`/pages/${r}`:""}/index.${n}x`);let y=P.replace(/Demo/g,w(r)).replace(/demo-page/g,r+"-page").replace(/demo.jsx/g,`${s?`pages/${r}/`:""}index.${n}x`).replace(/#import#/g,o[n]).replace(/#logo#/g,l[n]).replace(/#render#/g,d[n]).replace(/#note#/g,m[n]);s&&(y=y.replace(/.\/assets/g,"@/assets")),t.writeFileSync(u,y,"utf8")}$("green",g.initSucceed)}async function h(t="demo"){const r=f("../template/static",1),c=f(`${t}/src`),n=f("../template/assets",1),o=f(`${t}/src/assets`);await i(r,c),await i(n,o);const p=a(g.depInstalling),l=s.promisify(e.exec);p.start(),await E(t),await l(`cd ${t} && npm i @babel/polyfill`),p.stop(),$("green",g.depInstalled)}module.exports={WriteComponent:x,WriteConfig:S,WritePackage:E,WritePage:F,WritePageStatic:h};