const e=require("fs"),r=require("chalk"),i=require("inquirer"),{DLL_TEXT:d}=require("../i18n"),{DEPENDENCE:l,AbsPath:t,BuildCb:o,IsExist:s,ShowMsg:n,ShowTitle:u}=require("../util");module.exports=async function(){if(u("dll"),!s("package.json"))return n("red",d.judgePackage);if(!s("node_modules"))return n("red",d.judgeModules);if(!s("src"))return n("red",d.judgeSrc);const a=["@babel/polyfill","lodash","lodash-es","react-hot-loader"],c=[{choices:Object.keys(l).sort().reduce((e,r)=>(!a.includes(r)&&e.push(r),e),[]),message:d.qaVendor,name:"vendor",type:"checkbox",validate:e=>!!e.length||r.redBright(d.judgeVendor)}],g=(await i.prompt(c)).vendor,h=require("../config/webpack.dll"),[f,p]=await o(h(g));if(f||!p)n("red",d.dllFail);else{const r=t("dist/static/vendor.json"),i=JSON.stringify({vendor:g},null,"\t");e.writeFileSync(r,i,"utf8"),n("green",d.dllSucceed)}};