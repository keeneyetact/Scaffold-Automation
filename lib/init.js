const e=require("child_process"),t=require("util"),a=require("chalk"),i=require("inquirer"),s=require("ora"),{INIT_TEXT:r}=require("../i18n"),{WritePackage:n,WritePage:o,WritePageStatic:p}=require("../template"),{REGEXP_PROJ_NAME:l,GetVersion:c,ReadFolder:d,ShowMsg:m,ShowTitle:u}=require("../util");module.exports=async function(g){if(u("init"),g)return l.test(g)?d("").includes(g)?m("red",r.judgeExist):p(g):m("red",r.judgeName);const y=[{default:"demo",message:r.qaName,name:"name",type:"input",validate:e=>l.test(e)?!d("").includes(e)||a.redBright(r.judgeExist):a.redBright(r.judgeName)},{choices:["SPA","MPA"],default:0,message:r.qaType,name:"type",type:"list"},{default:!1,message:r.qaState,name:"state",type:"confirm"},{default:!1,message:r.qaRouter,name:"router",type:"confirm"},{default:!1,message:r.qaProps,name:"props",type:"confirm"},{default:!1,message:r.qaTs,name:"typescript",type:"confirm"},{choices:r.dependencies,message:r.qaDependence,name:"dependence",type:"checkbox"},{default:!1,message:r.qaInstall,name:"install",type:"confirm"}],f=await i.prompt(y),{dependence:q,install:h,name:w,props:b,router:x,state:P,type:j,typescript:E}=f,T=["@babel/polyfill","react","react-dom","react-hot-loader"];P&&T.push("mobx","mobx-react"),x&&T.push("react-router-dom"),b&&T.push("prop-types");const N=["node",...T].sort().filter(e=>"@babel/polyfill"!==e&&!e.includes("mobx")).map(e=>`@types/${e}`);q.reduce((e,t)=>(e.push(t.split(" ")[0]),e),T).sort();const S=j.toLowerCase().includes("mpa");if(await o(w,S,E),h){const a=s(r.installing),i=t.promisify(e.exec);a.start(),await n(w,{},{},E),await i(`cd ${w} && npm i ${T.join(" ")}${E?` && npm i -D ${N.join(" ")}`:""}`),a.stop(),m("green",r.installed)}else{const e=s(r.obtaining);e.start();const t=await c(T),a=E?await c(N):{};await n(w,t,a,E),e.stop(),m("yellow",r.obtained)}};