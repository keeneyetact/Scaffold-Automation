const e=require("child_process"),i=require("util"),t=require("latest-version"),r=require("ora"),{INIT_TEXT:s}=require("../i18n"),{InitAnswer:n}=require("../pipe"),a=require("../temp"),{AsyncTo:o,ShowMsg:c,ShowTitle:u}=require("../util/setting");async function l(e=[]){return e.reduce(async(e,i)=>{const r=await e,s=await t(i);return r[i]=s,r},Promise.resolve({}))}module.exports=async function(){u("init");const{DEPS:t,DEVDEPS:p,FRAME:w,NAMEP:E,STYLE:S,TYPE:T,USE_INSTALL:d,USE_TS:m}=await n(),q=r(s.getting);q.start();const y=new a({deps:await l(t),devDeps:await l(p),frame:w,projName:E,style:S,useMpa:"mpa"===T,useTs:m});if(await y.writeProject(),q.stop(),d){const t=i.promisify(e.exec),n=r(s.installing);n.start();const[a,u]=await o(t(`cd ${E} && yarn`));(a||!u)&&await t(`cd ${E} && npm i`),n.stop(),c("green",s.initSucceed)}else c("yellow",s.initFail)};