const e=require("child_process"),t=require("util"),a=require("chalk"),i=require("inquirer"),r=require("ora"),{INIT_TEXT:s}=require("../i18n"),{WritePackage:o,WritePage:n,WritePageStatic:p}=require("../template"),{REGEXP_PROJ_NAME:l,GetVersion:c,ReadFolder:d,ShowMsg:m,ShowTitle:u}=require("../util");module.exports=async function(g){if(u("init"),g)return l.test(g)?d("").includes(g)?m("red",s.judgeExist):p(g):m("red",s.judgeName);const y=[{default:"demo",message:s.qaName,name:"name",type:"input",validate:e=>l.test(e)?!d("").includes(e)||a.redBright(s.judgeExist):a.redBright(s.judgeName)},{choices:["SPA","MPA"],default:0,message:s.qaType,name:"type",type:"list"},{default:!1,message:s.qaState,name:"state",type:"confirm"},{default:!1,message:s.qaRouter,name:"router",type:"confirm"},{default:!1,message:s.qaProps,name:"props",type:"confirm"},{default:!1,message:s.qaTs,name:"typescript",type:"confirm"},{choices:s.dependencies,message:s.qaDependence,name:"dependence",type:"checkbox"},{default:!1,message:s.qaInstall,name:"install",type:"confirm"}],f=await i.prompt(y),{dependence:q,install:h,name:w,props:b,router:x,state:P,type:j,typescript:E}=f,T=["@babel/polyfill","@hot-loader/react-dom","react","react-dom","react-hot-loader"];P&&T.push("mobx","mobx-react"),x&&T.push("react-router-dom"),b&&T.push("prop-types");const N=["node",...T].sort().filter(e=>"@babel/polyfill"!==e&&!e.includes("mobx")).map(e=>`@types/${e}`);q.reduce((e,t)=>(e.push(t.split(" ")[0]),e),T).sort();const S=j.toLowerCase().includes("mpa");if(await n(w,S,E),h){const a=r(s.installing),i=t.promisify(e.exec);a.start(),await o(w,{},{},E),await i(`cd ${w} && npm i ${T.join(" ")}${E?` && npm i -D ${N.join(" ")}`:""}`),a.stop(),m("green",s.installed)}else{const e=r(s.obtaining);e.start();const t=await c(T),a=E?await c(N):{};await o(w,t,a,E),e.stop(),m("yellow",s.obtained)}};