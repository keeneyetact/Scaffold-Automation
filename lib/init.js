const e=require("child_process"),t=require("util"),i=require("latest-version"),r=require("ora"),{INIT_TEXT:s}=require("../i18n"),{InitAnswer:a}=require("../pipe"),n=require("../temp"),{AsyncTo:o,ShowMsg:c,ShowTitle:u}=require("../util/setting");async function l(e=[]){return e.reduce(async(e,t)=>{const r=await e,s=await i(t);return r[t]=s,r},Promise.resolve({}))}module.exports=async function(){u("init");const{DEPS:i,DEVDEPS:p,FRAME:w,NAMEP:E,STYLE:S,TYPE:T,USE_INSTALL:y,USE_TS:d}=await a(),m=r(s.getting);m.start();const q=new n({deps:await l(i),devDeps:await l(p),frame:w,projName:E,style:S,useMpa:"mpa"===T,useTs:d});if(await q.writeProject(),m.stop(),y){const i=t.promisify(e.exec),a=r(s.installing);a.start();const[n,u]=await o(i(`cd ${E} && yarn`));(n||!u)&&await i(`cd ${E} && npm i`),a.stop(),c("green",s.initSucceed)}else c("yellow",s.initFail);c("cyan",s.start(E))};