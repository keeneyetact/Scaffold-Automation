const e=require("child_process"),i=require("util"),t=require("latest-version"),r=require("ora"),{INIT_TEXT:s}=require("../i18n"),{InitAnswer:a}=require("../pipe"),n=require("../temp"),{AsyncTo:o,ShowMsg:c,ShowTitle:u}=require("../util/setting");async function p(e=[]){return e.reduce((async(e,i)=>{const r=await e,s=await t(i);return r[i]=s,r}),Promise.resolve({}))}module.exports=async function(){u("init");const{DEPS:t,DEVDEPS:l,FRAME:w,NAMEP:E,STYLE:S,TYPE:T,USE_INSTALL:y,USE_TS:d}=await a(),m=r(s.getting).start(),q=new n({deps:await p(t),devDeps:await p(l),frame:w,projName:E,style:S,useMpa:"mpa"===T,useTs:d});if(await q.writeProject(),m.stop(),y){const t=i.promisify(e.exec),a=r(s.installing).start(),[n,u]=await o(t(`cd ${E} && yarn`));(n||!u)&&await t(`cd ${E} && npm i`),a.stop(),c("green",s.initSucceed)}else c("yellow",s.initFail);c("cyan",s.start(E)),process.exit(1)};